c
response = format_for_datatable(@orders)
@orders
c
Order.count
format_for_datatable(@orders)
@orders
format_for_datatable(@orders)
c
@orders.first
@orders.size
@orders
c
base_query.select([
      "orders.id",
      "locations.name as location_name",
      "orders.custom_id as order_custom_id",
      "orders.created_at as order_datetime",
      "CONCAT(users.first_name, ' ', users.last_name) as customer_name",
      "orders.total_price_cents as order_total",
      "payment_methods.description as payment_method",
      "payments.amount_cents as payment_total",
      "payments.processor_transacion_id as payment_tx",
      "COALESCE(invoices.custom_id, external_invoices.custom_id) as invoice_custom_id"
    ].join(", ")).first
base_query.select([
      "orders.id",
      "locations.name as location_name",
      "orders.custom_id as order_custom_id",
      "orders.created_at as order_datetime",
      "CONCAT(users.first_name, ' ', users.last_name) as customer_name",
      "orders.total_price_cents as order_total",
      "payment_methods.description as payment_method",
      "payments.amount_cents as payment_total",
      "payments.processor_transacion_id as payment_tx",
      "COALESCE(invoices.custom_id, external_invoices.custom_id) as invoice_custom_id"
    ].join(", ")).size
base_query.select([
      "orders.id",
      "locations.name as location_name",
      "orders.custom_id as order_custom_id",
      "orders.created_at as order_datetime",
      "CONCAT(users.first_name, ' ', users.last_name) as customer_name",
      "orders.total_price_cents as order_total",
      "payment_methods.description as payment_method",
      "payments.amount_cents as payment_total",
      "payments.processor_transacion_id as payment_tx",
      "COALESCE(invoices.custom_id, external_invoices.custom_id) as invoice_custom_id"
    ].join(", "))
base_query.first
base_query.size
 base_query = base_query.where(created_at: date_range) if date_range
base_query = base_query.where(location: location) if location
base_query.first
base_query.size
base_query = Order.select("orders.*")
                   .joins(:location, :user)
                   .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
                   .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
                   .joins("LEFT JOIN invoices ON invoices.order_id = orders.id")
                   .joins("LEFT JOIN external_invoices ON external_invoices.order_id = orders.id")
c
base_query.first
base_query.size
base_query.class
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
      .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
      .joins("LEFT JOIN invoices ON invoices.order_id = orders.id")
      .joins("LEFT JOIN external_invoices ON external_invoices.order_id = orders.id")
c
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
      .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
      .joins("LEFT JOIN invoices ON invoices.order_id = orders.id")
      .joins("LEFT JOIN external_invoices ON external_invoices.order_id = orders.id")
      .select(consolidated_sales_fields)
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
      .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
      .joins("LEFT JOIN invoices ON invoices.order_id = orders.id")
      .joins("LEFT JOIN external_invoices ON external_invoices.order_id = orders.id")
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
      .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
      .joins("LEFT JOIN invoices ON invoices.order_id = orders.id")
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
      .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
base_query = includes(:location, :user)
      .joins("LEFT JOIN payments ON payments.payable_id = orders.id AND payments.payable_type = 'Order'")
      .joins("LEFT JOIN payment_methods ON payment_methods.id = payments.payment_method_id")
      .joins("LEFT JOIN invoices ON invoices.order_id = orders.id")
      .joins("LEFT JOIN external_invoices ON external_invoices.order_id = orders.id")
      .select(consolidated_sales_fields)
base_query
date_range
location
c
@orders = Order.consolidated_sales(
      location: @current_location,
      date_range: @date_range
    )
@current_location
@date_range
@to_date
@from_date 
params
params.fetch(:filter, {})
filter_params
c
user.email
user
customer
user
c
@cashier_transaction.errors
a.persisted?
a.errors
a = @cashier_transaction.save
@cashier_transaction
 @current_cashier_shift
c
params
c
params
c
payment[:payment_method_id]&.to_i
credit_payment_method.id
payment[:payment_method_id]
payment = order_params[:payments_attributes].first
order_params[:payments_attributes]
c
paid_amount = non_credit_payments.sum(:amount_cents)
non_credit_payments = payments.where.not(payment_method: credit_payment_method)
credit_payments = payments.where(payment_method: credit_payment_method)
non_credit_payments.sum(:amount_cents)
non_credit_payments
paid_amount = non_credit_payments.sum(:amount_cents)
credit_payments.any?
 non_credit_payments = payments - credit_payments
credit_payments = payments.where(payment_method: credit_payment_method)
credit_payment_method = PaymentMethod.find_by(name: "credit")
payments
c
non_credit_payments = payments - credit_payments
credit_payments = payments.where(payment_method: credit_payment_method)
credit_payment_method = PaymentMethod.find_by(name: "credit")
payment_amount >= @order.total_price_cents
payment_amount = payments.sum(:amount_cents)
credit_payments = payments.select { |payment| payment.payment_method == "credit" }
 payments.any?
payments
c
self
params
payments
c
@location
c
params
c
request.raw_post
request.methods
request.xhr?
request
c
params
c
@order.fast_stock_transfer_flag
@order
c
@current_cashier.location
@current_cashier
@current_cashier&.cashier_shifts
@current_cashier&.current_shifts
@current_cashier&.current_shift(current_user)
current_user
@current_cashier
@current_cashier_shift
@can_create_unpaid_orders
c
$global_settings
c
$global_settings
$global_settings[:multi_region]
Warehouse.create!(name: "Almac√©n #{self.name}", location: self)
Region.find_or_create_by!(name: 'default')
Region.count
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting_exists
c
setting
c
setting
Setting.create!(name: setting[:name], data_type: setting[:data_type], localized_name: setting[:localized_name], internal: setting[:internal], string_value: setting[:default])
setting
b = Setting.create!(name: setting[:name], data_type: setting[:data_type], localized_name: setting[:localized_name], internal: setting[:internal], string_value: setting[:default])
setting
a = Setting.find_by(name: setting[:name])
setting
setting_exists
c
@notification
c
@requisition.submit!
@requisition.may_submit?
@requisition
c
@requisition.submit!
@requisition.stage
 @requisition.may_submit?
c
@requisition.submit!
@requisition.may_submit?
@requisition.stage
@requisition
c
@current_warehouse
c
@current_location
c
@locations
c
@locations
c
@locations.class
@locations
